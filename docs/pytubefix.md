# Pytubefix

PyPI - Downloads GitHub Sponsors PyPI - License Read the Docs GitHub Tag PyPI - Version

Python3 Library for Downloading YouTube Videos

## Installation

```bash
pip install pytubefix
```

## Quickstart

### Download MP4 Video in Highest Resolution:

```python
from pytubefix import YouTube
from pytubefix.cli import on_progress

url = "url"

yt = YouTube(url, on_progress_callback=on_progress)
print(yt.title)

ys = yt.streams.get_highest_resolution()
ys.download()
```

### Download Audio-Only (.m4a):

```python
from pytubefix import YouTube
from pytubefix.cli import on_progress

url = "url"

yt = YouTube(url, on_progress_callback=on_progress)
print(yt.title)

ys = yt.streams.get_audio_only()
ys.download()
```

### Download a Complete Playlist:

```python
from pytubefix import Playlist
from pytubefix.cli import on_progress

url = "url"

pl = Playlist(url)
for video in pl.videos:
    ys = video.streams.get_audio_only()
    ys.download()
```

### Use OAuth Authentication:

```python
from pytubefix import YouTube
from pytubefix.cli import on_progress

url = "url"

yt = YouTube(url, use_oauth=True, allow_oauth_cache=True, on_progress_callback=on_progress)
ys = yt.streams.get_highest_resolution()
ys.download()  # Authenticate once for subsequent downloads
```

### Specify Output Directory for Downloads:

```python
from pytubefix import YouTube
from pytubefix.cli import on_progress

url = "url"

yt = YouTube(url, on_progress_callback=on_progress)
ys = yt.streams.get_highest_resolution()
ys.download(output_path="path/to/directory")
```

## Working with Subtitles/Caption Tracks

### View Available Subtitles:

```python
from pytubefix import YouTube

yt = YouTube('http://youtube.com/watch?v=2lAe1cqCOXo')
print(yt.captions)
```

### Print Subtitle Tracks:

```python
from pytubefix import YouTube

yt = YouTube('http://youtube.com/watch?v=2lAe1cqCOXo')
caption = yt.captions['a.en']
print(caption.generate_srt_captions())
```

### Save Subtitles to a Text File:

```python
from pytubefix import YouTube

yt = YouTube('http://youtube.com/watch?v=2lAe1cqCOXo')
caption = yt.captions['a.en']
caption.save_captions("captions.txt")
```

## Using Channels

### Get Channel Name:

```python
from pytubefix import Channel

c = Channel("https://www.youtube.com/@ProgrammingKnowledge/featured")
print(f'Channel name: {c.channel_name}')
Download All Videos from a Channel:

from pytubefix import Channel

c = Channel("https://www.youtube.com/@ProgrammingKnowledge")
print(f'Downloading videos by: {c.channel_name}')

for video in c.videos:
    video.streams.get_highest_resolution().download()
```

## Search for Videos

### Basic Search:

```python
from pytubefix import Search

results = Search('GitHub Issue Best Practices')
for video in results.videos:
    print(f'Title: {video.title}')
    print(f'URL: {video.watch_url}')
    print(f'Duration: {video.length} sec')
    print('---')
```

### Use Filters:

```python

from pytubefix.contrib.search import Search, Filter

filters = {
    'upload_date': Filter.get_upload_date('Today'),
    'type': Filter.get_type("Video"),
    'duration': Filter.get_duration("Under 4 minutes"),
    'features': [Filter.get_features("4K"), Filter.get_features("Creative Commons")],
    'sort_by': Filter.get_sort_by("Upload date")
}

s = Search('music', filters=filters)
for video in s.videos:
    print(video.watch_url)
```

---

# Added PoToken support

- https://github.com/JuanBindez/pytubefix/pull/209

You might need to use PoToken to download videos from YouTube if you get blocked by YouTube with this error:

```log
2025-01-15 22:43:36 | ERROR | app.services.downloader:download_audio:41 - Error downloading audio: iSqGvjBoPh4 This request was detected as a bot. Use `use_po_token=True` or switch to WEB client to view. See more details at https://github.com/JuanBindez/pytubefix/pull/209
```

The proof of origin (PO) token is a parameter that YouTube requires to be sent with video playback requests from some clients. Without it, format URL requests from affected customers may return HTTP error 403, error with bot detection, or result in your account or IP address being blocked.

This token is generated by BotGuard (Web) / DroidGuard (Android) to attest the requests are coming from a genuine client.

The generation of PoToken by botguard involves several obfuscated functions created dynamically, which can have misleading ramifications, and is almost impossible to replicate in Python.

Using PoToken

As it is not an easy task to generate the PoToken in Python, we will have to resort to external resources

Manually acquiring a PO Token from a browser for use when logged out

This process involves manually obtaining a PO token generated from YouTube in a web browser and then manually passing it to pytubefix via the use_po_token=True argument. Steps:

Open a browser and go to any video on YouTube Music or YouTube Embedded (e.g. https://www.youtube.com/embed/aqz-KE-bpKQ). Make sure you are not logged in to any account!

Open the developer console (F12), then go to the "Network" tab and filter by v1/player

Click the video to play and a player request will appear in the network tab

In the request payload JSON, find the PO Token at serviceIntegrityDimensions.poToken and save that value

In the request payload JSON, find the visitorData at context.client.visitorData and save that value

In the pytubefix code, pass the parameter use_po_token=True, to send the visitorData and PoToken:

We can also use some scripts that speed up this process, for example: https://github.com/YunzheZJU/youtube-po-token-generator or any other script of your choice

After obtaining the PoToken and the linked visitorData, you can send them to pytubefix similar to the oauth method:

from pytubefix import YouTube

url = input("url >")

yt = YouTube(url, use_po_token=True)
print(yt.title)

ys = yt.streams.get_highest_resolution()
ys.download()
This will ask the terminal to input visitorData and PoToken respectively.

You can also customize the function that inserts visitorData and PoToken, just pass it using po_token_verifier, similar to #190

If allow_oauth_cache (we should change the name to allow_cache, but let's maintain compatibility) is True, the visitorData and PoToken will be cached and reused in the next requests (They may expire).

FAQ

Detected as a bot even using PoToken

The main purpose of passing PO Token is to help prevent getting blocked (if on non-DC IP) and allow formats from web clients to work.

If you are being detected as a bot even after passing the PoToken, there are only two alternatives:

Log in with use_oauth (and risk getting your account banned)

Use a proxy to change your IP address.

If even after these attempts you continue to be detected, unfortunately there is nothing we can do.

Clients affected with PoToken

Currently ANDROID and WEB clients need PoToken to obtain functional streams, otherwise only progressive streams in 360p will work.

As the PoToken generated by BotGuard "is easier to get", pytubefix will default to the WEB client when using use_po_token=True.

To use the affected clients, we have to send the visitorData and PoToken via the API and then add the PoToken to each stream with the query pot parameter.

Observation

Although it is possible to use use_po_token together with use_oauth, it is not a good idea, as YouTube can track you more easily.
